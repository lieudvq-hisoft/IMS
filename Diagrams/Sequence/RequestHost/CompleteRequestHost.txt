actor Client
participant RequestHostController
participant RequestHostService
participant NotificationService

participant Database
activate Client
Client->RequestHostController: Send Http Request
activate RequestHostController
RequestHostController->RequestHostService: Call Create()
activate RequestHostService
RequestHostService->Database: Start transaction
activate Database
RequestHostService->Database: Execute query for request Host
RequestHostService<--Database: Return result
alt request not Exist
RequestHostService->RequestHostService: Set validPrecondition false
else Request host not completable
RequestHostService->RequestHostService: Set validPrecondition false
end

alt validPrecondition false
RequestHostService->Database: Rollback transaction
else
RequestHostService->Database: Execute query for ipAddresses
RequestHostService<--Database: Return result
loop for each ipAddress in ipAddresses
alt requestHost is for removal
RequestHostService->RequestHostService: Add to ipAssignment list
else 
RequestHostService->Database: Execute non-query unassign ip from server
RequestHostService<--Database: Return result
end
end

opt requestHost not for removal
RequestHostService->Database: Execute non-query assign ips to server
end
RequestHostService->Database: Execute non-query update requestHost status
RequestHostService<--Database: Return result

RequestHostService->RequestHostService: Call CreateUpgradeAndHostInspectionReport()
activate RequestHostService
RequestHostService<--RequestHostService: Return result
deactivate RequestHostService

alt create doc unsuccessfully 
RequestHostService->Database: Rollback transaction
else 
RequestHostService->Database: Commit transaction
RequestHostService->NotificationService: Call Add()
activate NotificationService
RequestHostService<--NotificationService: Return result
deactivate NotificationService
end
end
deactivate Database
RequestHostController<--RequestHostService: Return result
deactivate RequestHostService
Client<--RequestHostController: Return Http Response
deactivate RequestHostController

